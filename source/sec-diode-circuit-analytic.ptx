<?xml version="1.0" encoding="UTF-8"?>

<section xml:id="sec-diode-circuit-analytic" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Analysis of diode circuits</title>

    <p>
        How do we analyze circuits containing diodes? The simplest way is to use the cartoonish behavior demonstrated in <xref ref="fig-diode-cartoon"/>, guessing at whether each diode is off or on, and then determining whether inconsistencies arise when analyzing the rest of the circuit elements. For example, let's analyze the circuit in <xref ref="fig-diode-simple-example"/>
        <figure xml:id="fig-diode-simple-example">
            <image>
                <shortdescription></shortdescription>
                <latex-image>
                    <xi:include parse="text" href="./figures/fig-diode-simple-example.ptx" />
                </latex-image>
            </image>
        </figure>
        In this circuit, the diode engages whenever the current passes through the diode in the forward direction while also allowing for the forward voltage drop <m>V_F</m> across the diode in the forward direction. So, whenever <m>\tilde{V}_\text{in}>V_F</m>, the diode is on and <m>\tilde{V}_\text{out}=\tilde{V}_\text{in}-V_F</m>. The diode is off otherwise, meaning <m>\tilde{V}_\text{out}=0</m>V. This behavior is shown in <xref ref="fig-diode-simple-example-plot"/>.
        
        <figure xml:id="fig-diode-simple-example-plot"> 
            <image>
                <shortdescription></shortdescription>
                <sageplot>
                import numpy as np
                import scipy.constants as sc
                import matplotlib.pyplot as plt

                t = np.linspace(0,1,500);
                Vin_array = 5*np.sin(20*t);
                Vout = np.zeros(np.size(t));
                Varr = np.zeros(np.size(t));

                R, VT, I0 = [1e4, 0.025, 3.0e-12];
                T=293;

                target = 1.0e-8;

                for i1 in range(np.size(t)):
                    Vin = Vin_array[i1];

                    # Initial Guesses for the solution
                    V = 3.0

                    # Main loop
                    error = 1.0
                    while error > target:
                        f = Vin - V - I0*R*(np.exp(sc.e*V/(sc.k*T))-1);
                        fp = -1-I0*R*sc.e/(sc.k*T)*np.exp(sc.e*V/(sc.k*T));
                        DeltaV = f/fp;
                        V -= DeltaV;
                        error = DeltaV;

                    Vout[i1]=Vin-V;
                    Varr[i1]=V;

                plt.figure(1);
                plt.plot(t,Vin_array,'b',label='$V_{in}$');
                plt.plot(t,Vout,'r-.', label='$V_{out}$');
                plt.plot(t,Varr,'k--', label='$V_D$');
                plt.legend();
                plt.xlabel('Time (s)');
                plt.ylabel('Voltage (V)');
                plt.savefig("fig-diode-simple-example-plot-1.svg");
                plt.savefig("fig-diode-simple-example-plot-1.pdf");
                </sageplot>   
            </image>
        </figure>
      
    </p>        
    <p>
        The steps to follow are:
        <ol>
            <li>
                <p>
                    Check the conditions in the circuit and see if it is possible to achieve a forward voltage drop <m>V_F</m> across the diode. If it is completely impossible, then the diode will be off and you can treat it as a circuit break. If it is possible that the diode may be forward biased, then continue on to the next steps.
                </p>
            </li>
            <li>
                <p>
                    For each diode in your circuit, guess whether the diode is on or off. For each diode that is on, let the voltage drop <m>\left(\Delta V\right)_D=V_F</m> be locked. For each diode that is off, treat the diode as a circuit break meaning no current can pass through it.
                </p>
            </li>
            <li>
                <p>
                    Analyze the rest of the circuit elements and search for inconsistencies. 
                </p>
            </li>
            <li>
                <p>
                    If any results of your analysis conflict with your guesses about diodes that are on/off, then go back and change your guesses until there are no inconsistencies.
                </p>
            </li>
        </ol>
    </p>
    

</section>